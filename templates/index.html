<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DigitITBot ğŸ’¬</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>ğŸ’¬ DigitITBot</h1>
    <p>Your IT assistant for everything infrastructure, cloud, ITIL & more.</p>

    <!-- Full Name Input -->
    <label for="fullName">ğŸ‘¤ Enter Your Full Name:</label>
    <input type="text" id="fullName" placeholder="Your Full Name" />
    <button onclick="saveName()">Save</button>

    <!-- Language Filter -->
    <label for="languageFilter">ğŸŒ Preferred Language:</label>
    <select id="languageFilter">
      <option value="">Any</option>
      <option value="en">English</option>
      <option value="hi">Hindi</option>
      <option value="es">Spanish</option>
    </select>

    <!-- Tutorial Level Filter -->
    <label for="levelFilter">ğŸ¯ Tutorial Level:</label>
    <select id="levelFilter">
      <option value="">Any</option>
      <option value="beginner">Beginner</option>
      <option value="intermediate">Intermediate</option>
      <option value="advanced">Advanced</option>
    </select>

    <!-- Programming Language Dropdown -->
    <label for="programmingLanguage">ğŸ’» Programming Language:</label>
    <select id="programmingLanguage">
      <option value="">None</option>
      <option value="python">Python</option>
      <option value="javascript">JavaScript</option>
      <option value="java">Java</option>
      <option value="c++">C++</option>
      <option value="c#">C#</option>
      <option value="go">Go</option>
      <option value="ruby">Ruby</option>
      <option value="php">PHP</option>
      <option value="typescript">TypeScript</option>
    </select>

    <div id="chatBox" class="chat-box"></div>

    <div class="input-area">
      <input type="text" id="userInput" placeholder="Ask an IT question..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    const nameKey = "digititbot_user_name";

    function saveName() {
      const name = document.getElementById("fullName").value.trim();
      if (name) {
        localStorage.setItem(nameKey, name);
        alert("âœ… Name Saved");
      }
    }

    function sendMessage() {
      const userInput = document.getElementById("userInput").value.trim();
      const userName = localStorage.getItem(nameKey) || "You";
      const language = document.getElementById("languageFilter").value;
      const level = document.getElementById("levelFilter").value;
      const languageCode = language || "";
      const programmingLanguage = document.getElementById("programmingLanguage").value;

      if (!userInput) return;

      const chatBox = document.getElementById("chatBox");
      const userBubble = `<div class="chat user"><strong>ğŸ‘¤ ${userName}:</strong> ${userInput}</div>`;
      const botThinking = `<div class="chat bot thinking" id="thinking">âŒ› Thinking...</div>`;

      chatBox.innerHTML += userBubble + botThinking;
      document.getElementById("userInput").value = "";
      chatBox.scrollTop = chatBox.scrollHeight;

      fetch("/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: userInput,
          user_name: userName,
          language: languageCode,
          level: level,
          programming_language: programmingLanguage
        })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("thinking").remove();
        const botReply = `<div class="chat bot"><strong>ğŸ¤– DigitITBot:</strong> ${data.response}</div>`;
        chatBox.innerHTML += botReply;
        chatBox.scrollTop = chatBox.scrollHeight;
      })
      .catch(err => {
        document.getElementById("thinking").remove();
        const errorReply = `<div class="chat bot error">âš ï¸ Error: Could not connect to DigitITBot.</div>`;
        chatBox.innerHTML += errorReply;
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    }

    // Pre-fill name from localStorage
    window.onload = () => {
      const savedName = localStorage.getItem(nameKey);
      if (savedName) {
        document.getElementById("fullName").value = savedName;
      }
    };
  </script>
</body>
</html>