<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DigitITBot üí¨</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>üí¨ DigitITBot</h1>
    <p class="subtitle">Your IT assistant for everything infrastructure, cloud, ITIL & more.</p>

    <!-- Full Name Input -->
    <div class="input-row">
      <label for="fullName">üë§ Enter Your Full Name:</label>
      <input type="text" id="fullName" placeholder="e.g., Ritesh Fernandes" />
      <button onclick="saveName()">Save</button>
    </div>

    <!-- Language Dropdown -->
    <div class="dropdown-row">
      <label for="languageSelect">üåê Tutorial Language</label>
      <select id="languageSelect">
        <option value="">All Languages</option>
        <option value="English">English</option>
        <option value="Hindi">Hindi</option>
        <option value="Spanish">Spanish</option>
        <option value="French">French</option>
        <option value="German">German</option>
      </select>
    </div>

    <!-- Level Dropdown -->
    <div class="dropdown-row">
      <label for="levelSelect">üì∫ Tutorial Level</label>
      <select id="levelSelect">
        <option value="">All Levels</option>
        <option value="Beginner">Beginner</option>
        <option value="Intermediate">Intermediate</option>
        <option value="Advanced">Advanced</option>
      </select>
    </div>

    <!-- Programming Language Dropdown -->
    <div class="dropdown-row">
      <label for="programmingSelect">üë®‚Äçüíª Programming Language</label>
      <select id="programmingSelect">
        <option value="">All Languages</option>
        <option value="Python">Python</option>
        <option value="JavaScript">JavaScript</option>
        <option value="Java">Java</option>
        <option value="C++">C++</option>
        <option value="C#">C#</option>
        <option value="Go">Go</option>
        <option value="Ruby">Ruby</option>
        <option value="PHP">PHP</option>
        <option value="Swift">Swift</option>
        <option value="TypeScript">TypeScript</option>
      </select>
    </div>

    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()">üåì Toggle Theme</button>

    <!-- Chat Box -->
    <div id="chat-box" class="chat-box"></div>

    <!-- Message Input -->
    <div class="input-row">
      <input type="text" id="user-input" placeholder="Ask an IT question..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    let fullName = localStorage.getItem("fullName") || "";

    document.addEventListener("DOMContentLoaded", () => {
      if (fullName) {
        document.getElementById("fullName").value = fullName;
      }
    });

    function saveName() {
      fullName = document.getElementById("fullName").value.trim();
      localStorage.setItem("fullName", fullName);
      alert("Name Saved");
    }

    async function sendMessage() {
      const input = document.getElementById("user-input");
      const message = input.value.trim();
      if (!message) return;

      const language = document.getElementById("languageSelect").value;
      const level = document.getElementById("levelSelect").value;
      const programming = document.getElementById("programmingSelect").value;

      const chatBox = document.getElementById("chat-box");
      chatBox.innerHTML += `<div class="user-message"><strong>üë§ ${fullName || 'You'}:</strong> ${message}</div>`;
      chatBox.innerHTML += `<div class="bot-message"><strong>ü§ñ DigitITBot:</strong> ‚åõ Thinking...</div>`;
      chatBox.scrollTop = chatBox.scrollHeight;

      input.value = "";

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: message,
            full_name: fullName,
            tutorial_language: language,
            tutorial_level: level,
            programming_language: programming
          })
        });
        const data = await res.json();
        document.querySelectorAll(".bot-message").pop().remove();
        chatBox.innerHTML += `<div class="bot-message"><strong>ü§ñ DigitITBot:</strong> ${marked.parse(data.response)}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
      } catch (err) {
        console.error(err);
        chatBox.innerHTML += `<div class="bot-message error">‚ö†Ô∏è Error: Could not connect to DigitITBot.</div>`;
      }
    }

    function toggleTheme() {
      document.body.classList.toggle("dark-mode");
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>