<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DigitITBot 💬</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
  <div class="chat-container">
    <h1 class="bot-title">💬 DigitITBot</h1>
    <p class="bot-subtitle">Your IT assistant for everything infrastructure, cloud, ITIL & more.</p>

    <div class="input-row">
      <label for="fullName">👤 Enter Your Full Name:</label>
      <input type="text" id="fullName" placeholder="e.g., Ritesh Fernandes" />
      <button onclick="saveName()">Save</button>
    </div>

    <div class="input-row">
      <label for="languageSelect">🌐</label>
      <select id="languageSelect">
        <option value="">All Languages</option>
        <option value="en">English</option>
        <option value="hi">Hindi</option>
        <option value="es">Spanish</option>
      </select>

      <label for="levelSelect">📺</label>
      <select id="levelSelect">
        <option value="">All Levels</option>
        <option value="beginner">Beginner</option>
        <option value="intermediate">Intermediate</option>
        <option value="advanced">Advanced</option>
      </select>

      <label for="programmingLanguage">💻</label>
      <select id="programmingLanguage">
        <option value="">All Languages</option>
        <option value="python">Python</option>
        <option value="javascript">JavaScript</option>
        <option value="java">Java</option>
        <option value="c++">C++</option>
        <option value="c#">C#</option>
        <option value="ruby">Ruby</option>
        <option value="go">Go</option>
      </select>

      <button id="themeToggle" onclick="toggleTheme()">🌓 Toggle Theme</button>
    </div>

    <div id="chat-box" class="chat-box"></div>

    <div class="chat-input">
      <input type="text" id="user-input" placeholder="Ask an IT question..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    const botName = "DigitITBot";
    const chatBox = document.getElementById("chat-box");

    function addMessage(sender, message, type) {
      const messageDiv = document.createElement("div");
      messageDiv.className = `message ${type}`;
      messageDiv.innerHTML = `<strong>${sender}</strong> ${message}`;
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function saveName() {
      const name = document.getElementById("fullName").value.trim();
      if (name) {
        localStorage.setItem("fullName", name);
        alert("Name saved!");
      } else {
        alert("Please enter your full name.");
      }
    }

    function getName() {
      return localStorage.getItem("fullName") || "You";
    }

    function sendMessage() {
      const userInput = document.getElementById("user-input");
      const message = userInput.value.trim();
      const fullName = getName();
      const language = document.getElementById("languageSelect").value;
      const level = document.getElementById("levelSelect").value;
      const programming = document.getElementById("programmingLanguage").value;

      if (message === "") return;

      addMessage(`👤 ${fullName}:`, message, "user");
      userInput.value = "";
      addMessage(`🤖 ${botName}:`, "⌛ Thinking...", "bot");

      fetch("/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message,
          full_name: fullName,
          language,
          level,
          programming_language: programming
        })
      })
      .then(response => response.json())
      .then(data => {
        const reply = data.response || "⚠️ Error: No response from DigitITBot.";
        document.querySelector(".message.bot:last-child").innerHTML = `<strong>🤖 ${botName}:</strong> ${reply}`;
      })
      .catch(() => {
        document.querySelector(".message.bot:last-child").innerHTML = `<strong>🤖 ${botName}:</strong> ⚠️ Error: Could not connect to DigitITBot.`;
      });
    }

    function toggleTheme() {
      document.body.classList.toggle("dark-mode");
    }

    // Load saved name on page load
    window.onload = () => {
      const savedName = localStorage.getItem("fullName");
      if (savedName) document.getElementById("fullName").value = savedName;
    };
  </script>
</body>
</html>